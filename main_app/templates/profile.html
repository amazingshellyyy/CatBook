{% extends 'base.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock styles %}
{% block script %}
<script defer type="text/javascript" src="{% static 'js/profile.js' %}"></script>
<script defer type="text/javascript" src="{% static 'js/follow.js' %}"></script>
{% endblock script %}
{% block nav_left%}
<li class="nav-item">
    <a class="nav-link" href="{% url 'global_view'%}">Global</a>
</li>
{% endblock nav_left%}
{% block nav_right%}
<div class="search-bar form-inline">
    <form method="POST" class="form-inline my-2 my-lg-0">
        {% csrf_token %}
        <input class="form-control mr-sm-2" type="search" name="query" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0 search-btn" type="submit">
            <ion-icon class="search-icon" name="search-outline"></ion-icon>
        </button>
    </form>
</div>
{% if user.is_authenticated %}
<li class="nav-item">
    <a class="nav-link" href="{% url 'logout'%}">Log Out</a>
</li>
{% else %}
<li class="nav-item">
    <a class="nav-link" href="{% url 'login'%}">Log In</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{% url 'signup'%}">Sign Up</a>
</li>
{% endif %}
{% endblock nav_right%}
{% block content %}
<div class="box1">
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <div>
                    <div class="profile-img-box">
                        {% for image in images %}
                        <a href="{{ image.upload.url }}" target="_blank"><img class="img-thumbnail profile-img"
                                src="{{ image.upload.url }}"></a>
                        {% endfor%}
                        <a href="{% url 'upload'%}">upload</a>
                    </div>
                </div>


            </div>
            <div class="col-sm-8">
                <h2>{{ user.username }}</h2>
                <p>{{ user.email }}</p>
                <h4>Followers: {{ follower_count }}</h4>
                {% if current_user %}
                <button type="button" class="btn btn-primary mt-5" onclick="location.href="
                    {% url 'profile_edit' pk=user.pk %}">
                    <ion-icon name="create-outline"></ion-icon>Edit Profile
                </button>
                {% else %}
                {% if following %}
                <button id="followBtn" type="button" class="btn btn-primary mt-5" style="opacity:0.7;"
                    data-id="{{ user.id }}">Unfollow</button>
                {% else %}
                <button id="followBtn" type="button" class="btn btn-primary mt-5"
                    data-id="{{ user.id }}">Follow</button>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>
<div class="container mt-2">
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item first-tab">
            <a class="nav-link active" id="pills-posts-tab" data-toggle="pill" href="#pills-posts" role="tab"
                aria-controls="pills-posts" aria-selected="true">
                <ion-icon name="person-outline" class="tab-icon"></ion-icon>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="pills-act-feed-tab" data-toggle="pill" href="#pills-act-feed" role="tab"
                aria-controls="pills-act-feed" aria-selected="false">
                <ion-icon name="paw-outline" class="tab-icon"></ion-icon>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="pills-followers-tab" data-toggle="pill" href="#pills-followers" role="tab"
                aria-controls="pills-followers" aria-selected="false">
                <ion-icon name="people-outline" class="tab-icon"></ion-icon>
            </a>
        </li>
    </ul>
    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-posts" role="tabpanel" aria-labelledby="pills-posts-tab">
            <div class="posts">
                <h3>Personal Post</h3>
                {% for post in posts%}
                <div class="row">
                    <div class="col-sm-3"></div>
                    <div class="card col-sm-6" style="width: 18rem;">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-2"><img class="profile-img"
                                        src="{% static 'images/user-placeholder.jpg'%}" alt="" style="height:50px;">
                                </div>
                                <div class="col-sm-10">
                                    <a href="{% url 'post_detail' pk=post.pk %}" class="card-title">{{post.title}}</a>
                                    <h6 class="card-subtitle mb-2 text-muted">{{post.date}}</h6>
                                </div>
                            </div>
                            <p class="card-text">{{post.context}}</p>
                            <a href="#" class="card-link">Like <ion-icon name="heart"
                                    style="position:relative;top:3px;">
                                </ion-icon>{{post.likes}}</a>
                            <a href="{% url 'comment_create' pk=post.pk %}" class="card-link">comment <ion-icon
                                    name="chatbox-outline" style="position:relative;top:3px;"></ion-icon></a>

                            {{ post.body | linebreaks }}
                            {% for comment in comments %}
                            <div class="row">
                                <div class="col-sm-10">
                                    <h5 class="font-weight-normal">{{comment.context}}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted font-weight-normal">{{post.user.username}}
                                        - {{comment.date}}</h6>
                                </div>
                                {{ comment.body | linebreaks }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-sm-3"></div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="tab-pane fade" id="pills-act-feed" role="tabpanel" aria-labelledby="pills-act-feed-tab">
            <div class="act-feed">
                <h3>Activity Feed</h3>
                <!-- need to generate based on post commented, following post and post likes  -->
                {% for post in activity%}
                <div class="row">
                    <div class="col-sm-3"></div>
                    <div class="card col-sm-6 mb-2" style="width: 18rem;">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-2"><img class="profile-img"
                                        src="{% static 'images/user-placeholder.jpg'%}" alt="" style="height:50px;">
                                    <a href="{% url 'profile' pk=post.user.id %}"
                                        class="card-text">{{post.user.username}}</a>
                                </div>
                                <div class="col-sm-10">
                                    <a href="{% url 'post_detail' pk=post.pk %}" class="card-title">{{post.title}}</a>
                                    <h6 class="card-subtitle mb-2 text-muted">{{post.date}}</h6>
                                </div>
                            </div>
                            <p class="card-text">{{post.context}}</p>
                            <a href="#" class="card-link">Like <ion-icon name="heart"
                                    style="position:relative;top:3px;">
                                </ion-icon>{{post.likes}}</a>
                            <a href="{% url 'comment_create' pk=post.pk %}" class="card-link">comment <ion-icon
                                    name="chatbox-outline" style="position:relative;top:3px;"></ion-icon></a>
                            <div></div>
                            <!-- {{ post.body | linebreaks }} -->

                        </div>
                        <!-- {% for comment in comments %}
                        <div class="row">
                            <div class="col-sm-10">
                                <h5 class="font-weight-normal">{{comment.context}}</h5>
                                <h6 class="text-muted font-weight-normal">{{post.user.username}} - {{comment.date}}</h6>
                            </div>
                            {{ comment.body | linebreaks }}
                        </div>
                        {% endfor %} -->
                    </div>
                    <div class="col-sm-3"></div>

                </div>

                {% endfor %}

            </div>
        </div>
        <div class="tab-pane fade" id="pills-followers" role="tabpanel" aria-labelledby="pills-followers-tab">
            <h3>Followers</h3>
            <div id="followers">
                {% if followers %}
                {% for f in followers %}
                <div><a href="{% url 'profile' pk=f.user_id.id %}">{{ f.user_id }}</a></div>
                {% endfor %}
                {% else %}
                <div>
                    <p>0</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}